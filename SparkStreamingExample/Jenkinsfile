pipeline {
    agent any
    tools {
        maven 'maven'
    }

    // job metadata
    def jobName = env.JOB_NAME
    def buildNumer = env.BUILD_NUMBER

    stages {
        stage('Initialize') {
            steps {
                // do sparse checkout of ans repo
                checkout([$class: 'GitSCM', branches: [[name: '*/master']],
                          doGenerateSubmoduleConfigurations: false,
                          extensions: [[$class: 'SparseCheckoutPaths',sparseCheckoutPaths: [[path: 'SparkStreamingExample']]]], submoduleCfg: [],
                          userRemoteConfigs: [[url: 'https://github.com/abhishekray07/test-python-app.git']]])
            }
        }

        stage('Build') {
            steps {
                // maven build
                sh 'mvn -f SparkStreamingExample/pom.xml clean install'
            }

            post {
                success {
                    def s3Path = "applications/${jobName}/${buildNumber}/"
                    withAWS(region: 'us-east-1') {
                        s3Upload bucket: 'qdeploy', file: "SparkStreamingExample/target/SparkStreamingExample-1.0.0.jar", path: s3Path
                    }

//                    marathon credentialsId: '', docker: '', filename: 'SparkStreamingExample/marathon.json', id: '', uris: [[uri: "s3a://qdeploy/applications/${jobName}/${buildNumer}/SparkStreamingExample-1.0.0.jar"]], url: 'http://dwhmaster7494979740769402770:8080'
                }
            }
        }
    }
}