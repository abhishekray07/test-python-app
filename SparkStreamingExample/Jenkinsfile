pipeline {
    agent any
    tools {
        maven 'maven'
    }

    stages {
        stage('Initialize Repo') {
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '*/master']],
                          doGenerateSubmoduleConfigurations: false,
                          extensions: [[$class: 'SparseCheckoutPaths',sparseCheckoutPaths: [[path: 'SparkStreamingExample']]]], submoduleCfg: [],
                          userRemoteConfigs: [[url: 'https://github.com/abhishekray07/test-python-app.git']]])
            }
        }

        stage('Build') {
            steps {
                sh 'mvn -f SparkStreamingExample/pom.xml clean install'
            }

            post {
                success {
                    withAWS(region: 'us-east-1') {
                        s3Upload bucket: 'qdeploy', file: 'SparkStreamingExample/target/SparkStreamingExample-1.0.0.jar', path: 'applications/${JOB_NAME}/${BUILD_NUMBER}/'
                    }
                    marathon credentialsId: '', docker: '', filename: 'SparkStreamingExample/marathon.json', id: '', uris: [[uri: 's3a://qdeploy/applications/${JOB_NAME}/${BUILD_NUMBER}/SparkStreamingExample-1.0.0.jar']], url: 'http://dwhmaster7494979740769402770:8080'
                }
            }
        }
    }
}